tinymce.PluginManager.add("productList",function(t,e){function i(){return t.settings.listProducts}function s(){return t.settings.listSeletedProduct}var n,o,l=this;t.settings.listProducts=[{text:"Chưa có dữ liệu",value:""}],t.settings.listSeletedProduct=[{type:"label",text:""}],tinyMCE.DOM.loadCSS(e+"/css/productlist.min.css"),l.refresh=function(){n.value(null),n.menu=null,n.settings.values=n.settings.menu=i()},l.refreshSelectedProducts=function(){},t.addButton("productList",{text:"Insert Products",icon:!1,onclick:function(){var e=t.windowManager.open({title:"Nhập danh sách sản phẩm",width:800,height:240,buttons:[{text:"Thêm vào nội dung",classes:"widget btn primary first abs-layout-item",id:"uniqueid",disabled:!1,onclick:"submit"},{text:"Hủy",onclick:"close"}],body:[{type:"textbox",name:"title",tooltip:"Nhập tên sản phẩm để tìm",autofocus:!0},{type:"listbox",name:"listProducts",multiline:!0,tooltip:"Chọn sản phẩm trong danh sách",values:i(),onselect:function(t){for(var i=e.find("#listProducts"),n=s(),l={type:"textbox",text:i.text(),value:i.value(),classes:"selected-text-box",tooltip:i.text(),onclick:function(){for(var t=tinyMCE.activeEditor.settings.listSeletedProduct,e=[],i=0;i<=t.length-1;i++)t[i].value!=this.settings.value&&e.push(t[i]);tinyMCE.activeEditor.settings.listSeletedProduct=e,tinyMCE.activeEditor.plugins.productList.refreshSelectedProducts()}},u=!0,c=n.length-1;c>=0;c--)"label"==n[c].type?n.splice(c,1):n[c].value==l.value&&(u=!1);u&&(n.push(l),o.append(l).reflow()),tinyMCE.activeEditor.settings.listSeletedProduct=n}},{type:"container",label:"Sản phẩm",name:"selectedProducts",minHeight:106,layout:"flow",items:s()}],onsubmit:function(e){for(var i=tinyMCE.activeEditor.settings.listSeletedProduct,s="",n=0;n<=i.length-1;n++)s+=i[n].value+",";s=s.slice(0,-1),t.insertContent('[products slugs="'+s+'"/]')},onclose:function(e){tinyMCE.activeEditor.settings.listSeletedProduct=[{type:"label",text:""}],tinyMCE.activeEditor.settings.listProducts=[{text:"Chưa có dữ liệu",value:""}],o.remove(),n.remove(),t.windowManager.close()},onkeyup:function(t){var i=e.find("#title")[0],s=$("#"+i._id).val(),n=[];""==s?n=[{text:"Chưa có dữ liệu",value:""}]:$.ajax({url:"/system/product/find",type:"post",dataType:"json",data:{keyword:s},error:function(){},beforeSend:function(){},complete:function(){},successful:function(t){"successful"==t.status?(t.products.forEach(function(t){null!=t.title&&n.push({text:t.title,value:t.slug})}),n.length<=0&&(n=[{text:"Không tìm thấy",value:""}])):n=[{text:"Không tìm thấy",value:""}],tinyMCE.activeEditor.settings.listProducts=n,tinyMCE.activeEditor.plugins.productList.refresh()}})}});n=e.find("#listProducts")[0],o=e.find("#selectedProducts")[0]}})});